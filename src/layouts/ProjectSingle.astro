---
import { Image } from "astro:assets";
import Share from "@components/Share.astro";
import SimilarPosts from "@components/SimilarPosts.astro";
import { getSinglePage } from "@lib/contentParser.astro";
import dateFormat from "@lib/utils/dateFormat";
import similerItems from "@lib/utils/similarItems";
import { humanize, markdownify, slugify } from "@lib/utils/textConverter";
import { BiCalendarEdit, BiCategoryAlt } from "react-icons/bi/index.js";
import { getCollection, type CollectionEntry } from "astro:content";
import SimilarProjects from "./components/SimilarProjects.astro";
import "src/styles/markdown.scss";
import ProjectInfoCard from "./components/ProjectInfoCard.astro";

interface Props {
  project: CollectionEntry<"projects">;
}

const { project } = Astro.props;

const { data, id, slug } = project;
const { title, description, image, date, tags, categories, authors } = data;
const allAuthor = await getSinglePage("authors");
const author = allAuthor.find((author) => author.slug === authors[0]);

const projects = await getCollection("projects");
const similarProjects = similerItems(project, projects, slug);
const { Content } = await project.render();
---

<section class="section pt-4">
  <div class="">
    <article
      class="row large-container mr-auto ml-auto grid grid-cols-12 md:gap-20 justify-between lg:mb-6 max-w-[1400px]"
    >
      <div
        class="col-span-12 lg:col-span-4 lg:block static lg:sticky top-60 lg:mt-60"
      >
        <ProjectInfoCard project={project} />
      </div>

      <div class="col-span-12 lg:col-span-7 gap-8 grid grid-cols-1 relative">
        <div class="content text-left">
          <Content />
        </div>
      </div>
    </article>
  </div>
  {
    similarProjects.length > 0 && (
      <section class="section pt-0">
        <div class="large-container">
          <h2 class="mb-4 text-center h3">Similar Posts</h2>
          <SimilarProjects projects={similarProjects.slice(0, 3)} />
        </div>
      </section>
    )
  }
</section>
